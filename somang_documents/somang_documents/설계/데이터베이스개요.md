## T-Bridge 데이터베이스 개요

본 문서는 T-Bridge 서비스의 핵심 도메인을 구성하는 주요 데이터베이스 테이블의 구조와 역할을 정의합니다. PostgreSQL을 기준으로 데이터 타입을 예측하였으며, 이는 Supabase 백엔드 전략에 부합합니다.

### 핵심 테이블 목록

서비스의 주요 기능과 사용자 여정을 지원하기 위해 다음과 같은 핵심 테이블을 설계합니다.

* **profiles**: 사용자 정보 (소비자, 사업주, 관리자)
* **stores**: 판매점(가맹점) 정보
* **quote_requests**: 소비자의 견적 요청서
* **quotes**: 판매점이 제출한 표준 견적서
* **reviews**: 거래 완료 후 소비자가 작성하는 리뷰
* **chat_rooms**: 소비자와 판매점 간의 1:1 채팅방
* **chat_messages**: 채팅방 내의 메시지 기록

---

### 1. `profiles` - 사용자 정보

Supabase의 `auth.users` 테이블과 1:1로 연결되어 애플리케이션의 사용자 역할과 추가 정보를 관리합니다.

| 컬럼 명 (Column Name) | 데이터 타입 (Data Type)         | 설명                                              |
| :----------------- | :------------------------- | :---------------------------------------------- |
| **id**             | `uuid` (PK)                | 사용자 고유 ID. `auth.users.id`를 참조하는 외래 키.          |
| `role`             | `text`                     | 사용자의 역할 ('user', 'owner', 'admin'). RLS 정책의 기반. |
| `name`             | `text`                     | 사용자의 이름 또는 닉네임.                                 |
| `created_at`       | `timestamp with time zone` | 프로필 생성 시각.                                      |

### 2. `stores` - 판매점 정보

플랫폼에 입점한 통신 판매점(가맹점)의 상세 정보를 저장합니다.

| 컬럼 명 (Column Name) | 데이터 타입 (Data Type) | 설명 |
| :--- | :--- | :--- |
| **id** | `uuid` (PK) | 판매점 고유 ID. |
| `owner_id` | `uuid` (FK) | 판매점주의 프로필 ID. `profiles.id`를 참조. |
| `name` | `text` | 판매점 상호명. |
| `address` | `text` | 판매점 주소. 지도 서비스 연동에 사용. |
| `description` | `text` | 판매점 소개글. |
| `profile_image_url`| `text` | 판매점 대표 이미지 URL. Supabase Storage에 저장된 파일 경로. |
| `is_certified` | `boolean` | 'T-Bridge 인증 성지' 여부. `true`일 경우 특별 섹션에 노출. |
| `created_at` | `timestamp with time zone` | 판매점 등록 시각. |

### 3. `quote_requests` - 견적 요청서

최종 사용자가 원하는 통신 상품의 조건을 담아 제출하는 요청서 정보를 관리합니다.

| 컬럼 명 (Column Name) | 데이터 타입 (Data Type) | 설명 |
| :--- | :--- | :--- |
| **id** | `uuid` (PK) | 견적 요청 고유 ID. |
| `user_id` | `uuid` (FK) | 요청을 생성한 사용자의 ID. `profiles.id`를 참조. |
| `product_type` | `text` | 요청 상품 유형 ('mobile_phone', 'internet' 등). |
| `request_details`| `jsonb` | 요청 상세 내용 (예: { "model": "iPhone 17", "carrier": "SKT" }). |
| `status` | `text` | 요청 상태 ('open', 'closed', 'expired'). |
| `created_at` | `timestamp with time zone` | 요청 생성 시각. |

### 4. `quotes` - 표준 견적서

판매점이 사용자의 요청에 대해 제출하는 표준화된 견적서 정보를 저장합니다.

| 컬럼 명 (Column Name) | 데이터 타입 (Data Type) | 설명 |
| :--- | :--- | :--- |
| **id** | `uuid` (PK) | 견적서 고유 ID. |
| `request_id` | `uuid` (FK) | 이 견적이 응답하는 요청의 ID. `quote_requests.id`를 참조. |
| `store_id` | `uuid` (FK) | 견적을 제출한 판매점의 ID. `stores.id`를 참조. |
| `quote_details` | `jsonb` | 표준화된 견적 상세 정보 (출고가, 공시지원금, 추가지원금, 월요금, TCO 등). |
| `status` | `text` | 견적 상태 ('sent', 'viewed', 'accepted', 'rejected'). |
| `created_at` | `timestamp with time zone` | 견적 제출 시각. |

### 5. `reviews` - 거래 후기

실제 거래를 완료한 사용자가 판매점에 대해 작성한 후기와 별점을 관리합니다.

| 컬럼 명 (Column Name) | 데이터 타입 (Data Type) | 설명 |
| :--- | :--- | :--- |
| **id** | `uuid` (PK) | 리뷰 고유 ID. |
| `store_id` | `uuid` (FK) | 리뷰 대상 판매점의 ID. `stores.id`를 참조. |
| `user_id` | `uuid` (FK) | 리뷰를 작성한 사용자의 ID. `profiles.id`를 참조. |
| `quote_id` | `uuid` (FK) | 리뷰의 근거가 된 거래(견적) ID. `quotes.id`를 참조. |
| `rating` | `smallint` | 별점 (1~5). |
| `comment` | `text` | 리뷰 내용. |
| `created_at` | `timestamp with time zone` | 리뷰 작성 시각. |

### 6. `chat_rooms` - 채팅방

소비자와 판매점 간의 1:1 보안 채팅방 정보를 관리합니다.

| 컬럼 명 (Column Name) | 데이터 타입 (Data Type) | 설명 |
| :--- | :--- | :--- |
| **id** | `uuid` (PK) | 채팅방 고유 ID. |
| `user_id` | `uuid` (FK) | 참여한 소비자의 ID. `profiles.id`를 참조. |
| `store_id` | `uuid` (FK) | 참여한 판매점의 ID. `stores.id`를 참조. |
| `quote_id` | `uuid` (FK) | 채팅방 개설의 계기가 된 견적 ID. `quotes.id`를 참조. |
| `created_at` | `timestamp with time zone` | 채팅방 생성 시각. |

### 7. `chat_messages` - 채팅 메시지

각 채팅방에서 오고 간 모든 메시지를 기록하여 분쟁 발생 시 증거 자료로 활용합니다.

| 컬럼 명 (Column Name) | 데이터 타입 (Data Type) | 설명 |
| :--- | :--- | :--- |
| **id** | `uuid` (PK) | 메시지 고유 ID. |
| `room_id` | `uuid` (FK) | 메시지가 속한 채팅방의 ID. `chat_rooms.id`를 참조. |
| `sender_id` | `uuid` (FK) | 메시지를 보낸 사용자의 ID. `profiles.id`를 참조. |
| `content` | `text` | 메시지 내용. |
| `created_at` | `timestamp with time zone` | 메시지 전송 시각. |