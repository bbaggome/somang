## T-Bridge 통합 테이블 명세서

본 문서는 T-Bridge 서비스의 모든 데이터베이스 테이블에 대한 상세 명세를 기술합니다. `데이터베이스개요.md`와 `데이터베이스모델링.md` 문서를 기반으로 각 테이블의 컬럼, 데이터 타입, 제약 조건 및 설명을 종합하여 정의합니다.

---

### 1. profiles
- **테이블 설명**: 사용자의 역할 및 공통 프로필 정보를 관리합니다. Supabase의 `auth.users` 테이블과 1:1 관계를 가집니다.

| 컬럼 영문명       | 컬럼 한글명 | 데이터 타입        | 제약 조건                     | 설명                                                                          |
| :----------- | :----- | :------------ | :------------------------ | :-------------------------------------------------------------------------- |
| `id`         | 사용자 ID | `uuid`        | PK, FK (auth.users.id)    | 사용자 고유 ID. `auth.users` 테이블의 ID를 참조하며, 삭제 시 연쇄적으로 삭제(ON DELETE CASCADE)됩니다. |
| `role`       | 역할     | `text`        | NOT NULL, CHECK           | 사용자의 역할 ('user', 'owner', 'admin' 중 하나).                                    |
| `name`       | 이름/닉네임 | `text`        | NOT NULL                  | 사용자가 앱 내에서 사용할 표시 이름 또는 닉네임.                                                |
| `created_at` | 생성일시   | `timestamptz` | NOT NULL, DEFAULT `now()` | 프로필 레코드가 생성된 시각.                                                            |
| `deleted_at`   | 삭제일시   | `timestamptz` |                           | 프로필이 소프트 삭제된 시각. `null`이 아니면 삭제된 계정으로 간주합니다.                             |

### 2. user_settings
- **테이블 설명**: 사용자별 알림 등 개인화된 설정을 관리합니다.

| 컬럼 영문명                           | 컬럼 한글명   | 데이터 타입        | 제약 조건                    | 설명                                            |
| :------------------------------- | :------- | :------------ | :----------------------- | :-------------------------------------------- |
| `user_id`                        | 사용자 ID   | `uuid`        | PK, FK (profiles.id)     | 사용자 고유 ID. `profiles` 테이블을 참조하며, 연쇄적으로 삭제됩니다. |
| `chat_notification_enabled`      | 채팅알림여부   | `boolean`     | NOT NULL, DEFAULT `true` | 채팅 메시지 수신 시 푸시 알림 활성화 여부입니다.                  |
| `promotion_notification_enabled` | 프로모션알림여부 | `boolean`     | NOT NULL, DEFAULT `true` | 프로모션 정보 수신 시 푸시 알림 활성화 여부입니다.                 |
| `updated_at`                     | 수정일시     | `timestamptz` | DEFAULT `now()`          | 설정이 마지막으로 수정된 시각입니다.                          |

### 3. stores
- **테이블 설명**: 플랫폼에 입점한 통신 판매점(가맹점)의 상세 정보를 관리합니다.

| 컬럼 영문명                 | 컬럼 한글명    | 데이터 타입                 | 제약 조건                           | 설명                                                            |
| :--------------------- | :-------- | :------------------------- | :------------------------------ | :------------------------------------------------------------ |
| `id`                   | 판매점 ID    | `uuid`                     | PK, DEFAULT `gen_random_uuid()` | 판매점의 고유 식별자.                                                  |
| `owner_id`             | 소유주 ID    | `uuid`                     | NOT NULL, FK (profiles.id)      | 판매점주의 프로필 ID. `profiles` 테이블을 참조하며, 소유주 프로필 삭제 시 제한(RESTRICT)됩니다. |
| `name`                 | 판매점명      | `text`                     | NOT NULL                        | 판매점의 공식 상호명.                                                  |
| `zip_code`             | 우편번호      | `text`                     |                                 | 판매점 주소의 우편번호.                                               |
| `base_address`         | 기본주소      | `text`                     |                                 | 판매점 주소의 기본 부분 (예: 도로명 주소).                                |
| `detail_address`       | 상세주소      | `text`                     |                                 | 판매점 주소의 상세 부분 (예: 층, 호수).                                   |
| `location`             | 위치정보      | `geography(Point, 4326)`   |                                 | (변경) PostGIS의 geography 타입. 위치 기반 검색 성능 향상을 위해 GiST 인덱스를 사용합니다. |
| `description`          | 소개        | `text`                     |                                 | 판매점에 대한 간략한 소개글.                                              |
| `profile_image_url`    | 프로필이미지URL | `text`                     |                                 | 판매점 대표 이미지의 URL. Supabase Storage에 저장된 파일 경로.                 |
| `status`               | 상태        | `text`                     | NOT NULL, DEFAULT `'pending'`   | 판매점의 현재 상태 ('pending', 'approved', 'rejected', 'suspended' 중 하나). |
| `is_certified`         | 인증여부      | `boolean`                  | NOT NULL, DEFAULT `false`       | 'T-Bridge 인증 성지' 여부를 나타내는 플래그.                                |
| `response_rate`        | 응답률       | `numeric(5,2)`             | DEFAULT `0.00`                  | (캐시) 견적 응답률. DB 트리거를 통해 자동으로 계산하여 저장합니다.                     |
| `chat_room_count`      | 상담건수      | `integer`                  | DEFAULT `0`                     | (캐시) 총 상담 건수. DB 트리거를 통해 자동으로 계산하여 저장합니다.             |
| `accepted_quote_count` | 개통건수      | `integer`                  | DEFAULT `0`                     | (캐시) 총 개통(채택) 건수. DB 트리거를 통해 자동으로 계산하여 저장합니다.         |
| `created_at`           | 등록일시      | `timestamptz`              | NOT NULL, DEFAULT `now()`       | 판매점 정보가 시스템에 등록된 시각.                                          |
| `deleted_at`           | 삭제일시      | `timestamptz`              |                                 | 판매점 정보가 소프트 삭제된 시각.                                         |

### 4. store_verification_documents
- **테이블 설명**: 판매점이 제출하는 인증 서류 정보를 관리합니다.

| 컬럼 영문명           | 컬럼 한글명  | 데이터 타입        | 제약 조건                     | 설명                                         |
| :---------------- | :------ | :------------ | :-------------------------- | :----------------------------------------- |
| `id`              | 서류 ID   | `uuid`        | PK, DEFAULT `gen_random_uuid()` | 서류의 고유 식별자.                                |
| `store_id`        | 판매점 ID  | `uuid`        | NOT NULL, FK (stores.id)    | 서류를 제출한 판매점의 ID.                             |
| `document_type`   | 서류 종류  | `text`        | NOT NULL                    | 서류의 종류 ('business_license', 'telecom_license'). |
| `file_url`        | 파일 URL  | `text`        | NOT NULL                    | 업로드된 서류 파일의 URL (Supabase Storage 경로).        |
| `status`          | 심사 상태  | `text`        | NOT NULL, DEFAULT 'submitted' | 서류 심사 상태 ('submitted', 'approved', 'rejected'). |
| `created_at`      | 제출일시   | `timestamptz` | NOT NULL, DEFAULT `now()`   | 서류가 제출된 시각.                                |
| `reviewed_at`     | 심사일시   | `timestamptz` |                             | 관리자가 서류를 심사한 시각.                         |
| `reviewer_id`     | 심사자 ID  | `uuid`        | FK (profiles.id)            | 서류를 심사한 관리자의 ID.                           |
| `reject_reason`   | 거절 사유  | `text`        |                             | 심사가 거절된 경우 그 사유.                          |

### 5. promotions
- **테이블 설명**: 판매점이 등록하는 마케팅 프로모션 정보를 관리합니다.

| 컬럼 영문명        | 컬럼 한글명  | 데이터 타입        | 제약 조건                           | 설명                 |
| :------------ | :------ | :------------ | :------------------------------ | :----------------- |
| `id`          | 프로모션 ID | `uuid`        | PK, DEFAULT `gen_random_uuid()` | 프로모션의 고유 식별자.      |
| `store_id`    | 판매점 ID  | `uuid`        | NOT NULL, FK (stores.id)        | 프로모션을 게시한 판매점의 ID. | 
| `title`       | 제목      | `text`        | NOT NULL                        | 프로모션의 제목.          |
| `description` | 상세내용    | `text`        |                                 | 프로모션의 상세 설명.       |
| `start_date`  | 시작일시    | `timestamptz` | NOT NULL                        | 프로모션 시작 시각.        |
| `end_date`    | 종료일시    | `timestamptz` | NOT NULL                        | 프로모션 종료 시각.        |
| `created_at`  | 생성일시    | `timestamptz` | NOT NULL, DEFAULT `now()`       | 프로모션이 생성된 시각.      |

### 6. quote_requests
- **테이블 설명**: 소비자가 원하는 통신 상품의 조건을 담아 제출하는 견적 요청서 정보를 관리합니다.

| 컬럼 영문명            | 컬럼 한글명 | 데이터 타입        | 제약 조건                             | 설명                                               |
| :---------------- | :----- | :------------ | :-------------------------------- | :----------------------------------------------- |
| `id`              | 요청 ID  | `uuid`        | PK, DEFAULT `gen_random_uuid()`   | 견적 요청의 고유 식별자.                                   |
| `user_id`         | 사용자 ID | `uuid`        | NOT NULL, FK (profiles.id)        | 견적을 요청한 사용자의 ID.                                 |
| `product_type`    | 상품유형   | `text`        | NOT NULL, CHECK                   | 요청 상품의 유형 ('mobile_phone' 또는 'internet').        |
| `request_details` | 요청상세   | `jsonb`       | NOT NULL                          | (스키마 정의 필요) 요청 상세 내용을 담는 JSON 객체 (예: { "model": "iPhone 17" }). |
| `status`          | 상태     | `text`        | NOT NULL, DEFAULT `'open'`, CHECK | 요청의 현재 상태 ('open', 'closed', 'expired' 중 하나).    |
| `created_at`      | 요청일시   | `timestamptz` | NOT NULL, DEFAULT `now()`         | 견적 요청이 생성된 시각.                                   |
| `deleted_at`      | 삭제일시   | `timestamptz` |                                   | 견적 요청이 소프트 삭제된 시각.                              |

### 7. quotes
- **테이블 설명**: 판매점이 소비자의 요청에 대해 제출하는 표준화된 견적서 정보를 관리합니다.

| 컬럼 영문명          | 컬럼 한글명 | 데이터 타입        | 제약 조건                             | 설명                                                          |
| :-------------- | :----- | :------------ | :-------------------------------- | :---------------------------------------------------------- |
| `id`            | 견적 ID  | `uuid`        | PK, DEFAULT `gen_random_uuid()`   | 견적서의 고유 식별자.                                                |
| `request_id`    | 요청 ID  | `uuid`        | NOT NULL, FK (quote_requests.id)  | 이 견적서가 응답하는 대상 견적 요청의 ID.                                   |
| `store_id`      | 판매점 ID | `uuid`        | NOT NULL, FK (stores.id)          | 견적서를 제출한 판매점의 ID.                                           |
| `quote_details` | 견적상세   | `jsonb`       | NOT NULL                          | (스키마 정의 필요) 표준 견적 상세 정보를 담는 JSON 객체 (예: { "tco": 2100000 }). |
| `status`        | 상태     | `text`        | NOT NULL, DEFAULT `'sent'`, CHECK | 견적서의 현재 상태 ('sent', 'viewed', 'accepted', 'rejected' 중 하나). |
| `created_at`    | 제출일시   | `timestamptz` | NOT NULL, DEFAULT `now()`         | 견적서가 제출된 시각.                                                |
| `deleted_at`    | 삭제일시   | `timestamptz` |                                   | 견적서가 소프트 삭제된 시각.                                           |

### 8. reviews
- **테이블 설명**: 실제 거래를 완료한 소비자가 판매점에 대해 작성한 후기와 별점을 관리합니다.

| 컬럼 영문명       | 컬럼 한글명 | 데이터 타입        | 제약 조건                            | 설명                                                    |
| :----------- | :----- | :------------ | :------------------------------- | :---------------------------------------------------- |
| `id`         | 리뷰 ID  | `uuid`        | PK, DEFAULT `gen_random_uuid()`  | 리뷰의 고유 식별자.                                           |
| `store_id`   | 판매점 ID | `uuid`        | NOT NULL, FK (stores.id)         | 리뷰의 대상이 되는 판매점의 ID.                                   |
| `user_id`    | 사용자 ID | `uuid`        | NOT NULL, FK (profiles.id)       | 리뷰를 작성한 사용자의 ID.                                      |
| `quote_id`   | 견적 ID  | `uuid`        | NOT NULL, UNIQUE, FK (quotes.id) | 리뷰의 근거가 된 거래(견적) ID. 거래 건당 하나의 리뷰만 허용합니다. |
| `rating`     | 별점     | `smallint`    | NOT NULL, CHECK                  | 1부터 5까지의 정수형 별점.                                      |
| `comment`    | 리뷰내용   | `text`        |                                  | 소비자가 작성한 텍스트 형식의 리뷰.                                  |
| `is_hidden`  | 숨김여부   | `boolean`     | NOT NULL, DEFAULT `false`        | 관리자에 의해 부적절한 리뷰가 숨김 처리되었는지 여부.                     |
| `created_at` | 작성일시   | `timestamptz` | NOT NULL, DEFAULT `now()`        | 리뷰가 작성된 시각.                                           |
| `deleted_at` | 삭제일시   | `timestamptz` |                                  | 리뷰가 소프트 삭제된 시각.                                      |

### 9. review_votes
- **테이블 설명**: 리뷰에 대한 사용자의 '좋아요/싫어요' 반응을 기록합니다.

| 컬럼 영문명       | 컬럼 한글명 | 데이터 타입        | 제약 조건                           | 설명                           |
| :----------- | :----- | :------------ | :------------------------------ | :--------------------------- |
| `id`         | 투표 ID  | `uuid`        | PK, DEFAULT `gen_random_uuid()` | 투표의 고유 식별자.                  |
| `review_id`  | 리뷰 ID  | `uuid`        | NOT NULL, FK (reviews.id)       | 투표의 대상이 되는 리뷰의 ID.           |
| `user_id`    | 사용자 ID | `uuid`        | NOT NULL, FK (profiles.id)      | 투표한 사용자의 ID.                 |
| `vote_type`  | 투표 유형  | `text`        | NOT NULL, CHECK                 | 투표 유형 ('like' 또는 'dislike'). |
| `created_at` | 투표일시   | `timestamptz` | NOT NULL, DEFAULT `now()`       | 투표가 이루어진 시각.                 |

### 10. favorites
- **테이블 설명**: 사용자가 관심있어 하는 판매점 등 특정 항목을 저장합니다.

| 컬럼 영문명        | 컬럼 한글명 | 데이터 타입        | 제약 조건                           | 설명                                    |
| :------------ | :----- | :------------ | :------------------------------ | :------------------------------------ |
| `id`          | 찜 ID   | `uuid`        | PK, DEFAULT `gen_random_uuid()` | 찜하기 항목의 고유 식별자.                       |
| `user_id`     | 사용자 ID | `uuid`        | NOT NULL, FK (profiles.id)      | 찜한 사용자의 ID.                           |
| `target_id`   | 대상 ID  | `uuid`        | NOT NULL                        | 찜한 대상의 ID (예: store_id).              |
| `target_type` | 대상 유형  | `text`        | NOT NULL, CHECK                 | 찜한 대상의 종류 ('STORE', 'PHONE_MODEL' 등). |
| `created_at`  | 찜한일시   | `timestamptz` | NOT NULL, DEFAULT `now()`       | 찜한 시각.                                |

### 11. chat_rooms
- **테이블 설명**: 소비자와 판매점 간의 1:1 보안 채팅방 정보를 관리합니다.

| 컬럼 영문명       | 컬럼 한글명 | 데이터 타입        | 제약 조건                           | 설명                            |
| :----------- | :----- | :------------ | :------------------------------ | :---------------------------- |
| `id`         | 채팅방 ID | `uuid`        | PK, DEFAULT `gen_random_uuid()` | 채팅방의 고유 식별자.                  |
| `user_id`    | 사용자 ID | `uuid`        | NOT NULL, FK (profiles.id)      | 채팅에 참여하는 소비자의 ID.             |
| `store_id`   | 판매점 ID | `uuid`        | NOT NULL, FK (stores.id)        | 채팅에 참여하는 판매점의 ID.             |
| `quote_id`   | 견적 ID  | `uuid`        | FK (quotes.id)                  | 채팅방 개설의 계기가 된 견적의 ID (선택 사항). |
| `created_at` | 생성일시   | `timestamptz` | NOT NULL, DEFAULT `now()`       | 채팅방이 생성된 시각.                  |

### 12. chat_messages
- **테이블 설명**: 각 채팅방에서 전송된 모든 메시지를 시간 순서대로 기록합니다.

| 컬럼 영문명           | 컬럼 한글명  | 데이터 타입        | 제약 조건                             | 설명                        |
| :--------------- | :------ | :------------ | :-------------------------------- | :------------------------ |
| `id`             | 메시지 ID  | `uuid`        | PK, DEFAULT `gen_random_uuid()`   | 메시지의 고유 식별자.              |
| `room_id`        | 채팅방 ID  | `uuid`        | NOT NULL, FK (chat_rooms.id)      | 메시지가 속한 채팅방의 ID.          |
| `sender_id`      | 발신자 ID  | `uuid`        | NOT NULL, FK (profiles.id)        | 메시지를 보낸 사용자의 ID.          |
| `content`        | 내용      | `text`        | NOT NULL                          | 메시지의 텍스트 내용.              |
| `message_type`   | 메시지유형   | `text`        | NOT NULL, DEFAULT `'text'`, CHECK | 메시지 유형 ('text', 'image'). |
| `attachment_url` | 첨부파일URL | `text`        |                                   | 이미지 등 첨부 파일의 URL.         |
| `created_at`     | 전송일시    | `timestamptz` | NOT NULL, DEFAULT `now()`         | 메시지가 전송된 시각.              |

### 13. notices
- **테이블 설명**: 플랫폼 운영자가 게시하는 공지사항을 관리합니다.

| 컬럼 영문명         | 컬럼 한글명 | 데이터 타입        | 제약 조건                           | 설명                 |
| :------------- | :----- | :------------ | :------------------------------ | :----------------- |
| `id`           | 공지 ID  | `uuid`        | PK, DEFAULT `gen_random_uuid()` | 공지사항의 고유 식별자.      |
| `admin_id`     | 작성자 ID | `uuid`        | FK (profiles.id)                | 공지사항을 작성한 관리자의 ID. |
| `title`        | 제목     | `text`        | NOT NULL                        | 공지사항의 제목.          |
| `content`      | 내용     | `text`        | NOT NULL                        | 공지사항의 상세 내용.       |
| `is_published` | 게시여부   | `boolean`     | NOT NULL, DEFAULT `false`       | 사용자에게 게시되었는지 여부.   |
| `created_at`   | 작성일시   | `timestamptz` | NOT NULL, DEFAULT `now()`       | 공지사항이 작성된 시각.      |

### 14. policies
- **테이블 설명**: 버전이 관리되는 서비스 이용약관, 개인정보처리방침 등 법적 문서를 저장합니다.

| 컬럼 영문명        | 컬럼 한글명   | 데이터 타입        | 제약 조건                           | 설명                                                          |
| :------------- | :------- | :------------ | :------------------------------ | :------------------------------------------------------------ |
| `id`           | 약관 ID     | `serial`      | PK                              | 약관의 고유 식별자 (자동 증가).                                       |
| `policy_type`  | 약관 종류   | `text`        | NOT NULL, UNIQUE (with version) | 약관의 종류 ('terms_of_service', 'privacy_policy'). `version`과 함께 고유합니다. |
| `version`      | 버전        | `text`        | NOT NULL                        | 약관의 버전 (예: 'v1.1').                                         |
| `content`      | 내용        | `text`        | NOT NULL                        | 약관의 전체 내용.                                                  |
| `effective_date`| 효력 발생일 | `date`        | NOT NULL                        | 약관의 효력이 시작되는 날짜.                                            |
| `created_at`   | 생성일시    | `timestamptz` | DEFAULT `now()`                 | 약관이 시스템에 등록된 시각.                                           |

### 15. policy_consents
- **테이블 설명**: 사용자가 어떤 버전의 약관에 언제 동의했는지 이력을 관리합니다.

| 컬럼 영문명         | 컬럼 한글명 | 데이터 타입        | 제약 조건                           | 설명               |
| :------------- | :----- | :------------ | :------------------------------ | :--------------- |
| `id`           | 동의 ID  | `uuid`        | PK, DEFAULT `gen_random_uuid()` | 동의 이력의 고유 식별자.   |
| `user_id`      | 사용자 ID | `uuid`        | NOT NULL, FK (profiles.id)      | 약관에 동의한 사용자의 ID. |
| `policy_id`    | 약관 ID  | `integer`     | NOT NULL, FK (policies.id)      | 동의한 약관의 ID.      |
| `consent_date` | 동의일시   | `timestamptz` | NOT NULL, DEFAULT `now()`       | 사용자가 약관에 동의한 시각. |

### 16. support_tickets
- **테이블 설명**: 사용자의 1:1 고객 지원 문의를 관리합니다.

| 컬럼 영문명       | 컬럼 한글명 | 데이터 타입        | 제약 조건                             | 설명                                          |
| :----------- | :----- | :------------ | :-------------------------------- | :------------------------------------------ |
| `id`         | 문의 ID  | `uuid`        | PK, DEFAULT `gen_random_uuid()`   | 문의의 고유 식별자.                                 |
| `user_id`    | 사용자 ID | `uuid`        | NOT NULL, FK (profiles.id)        | 문의를 등록한 사용자의 ID.                            |
| `title`      | 제목     | `text`        | NOT NULL                          | 문의의 제목.                                     |
| `content`    | 내용     | `text`        | NOT NULL                          | 문의의 상세 내용.                                  |
| `status`     | 상태     | `text`        | NOT NULL, DEFAULT `'open'`, CHECK | 문의 처리 상태 ('open', 'in_progress', 'closed'). |
| `created_at` | 생성일시   | `timestamptz` | NOT NULL, DEFAULT `now()`         | 문의가 생성된 시각.                                 |

### 17. ticket_replies
- **테이블 설명**: 고객 지원 문의에 대한 답변을 관리합니다.

| 컬럼 영문명       | 컬럼 한글명 | 데이터 타입        | 제약 조건                           | 설명                                 |
| :----------- | :----- | :------------ | :------------------------------ | :--------------------------------- |
| `id`         | 답변 ID  | `uuid`        | PK, DEFAULT `gen_random_uuid()` | 답변의 고유 식별자.                      |
| `ticket_id`  | 문의 ID  | `uuid`        | NOT NULL, FK (support_tickets.id) | 관련 문의의 ID.                          |
| `replier_id` | 답변자 ID | `uuid`        | NOT NULL, FK (profiles.id)      | 답변을 작성한 사용자(또는 관리자)의 ID.        |
| `content`    | 답변내용   | `text`        | NOT NULL                        | 답변의 상세 내용.                        |
| `created_at` | 작성일시   | `timestamptz` | NOT NULL, DEFAULT `now()`       | 답변이 작성된 시각.                      |

### 18. audit_logs (신규 추가)
- **테이블 설명**: 플랫폼의 주요 변경 이력을 기록하는 감사 로그 테이블입니다.

| 컬럼 영문명       | 컬럼 한글명 | 데이터 타입        | 제약 조건                      | 설명                                         |
| :----------- | :----- | :------------ | :----------------------------- | :----------------------------------------- |
| `id`         | 로그 ID  | `uuid`        | PK, DEFAULT `gen_random_uuid()`| 로그 레코드의 고유 식별자.                         |
| `actor_id`   | 행위자 ID | `uuid`        | FK (profiles.id)               | 작업을 수행한 주체(사용자/관리자)의 ID.              |
| `action_type`| 작업 유형  | `text`        | NOT NULL                       | 수행된 작업의 종류 (예: 'STORE_APPROVED').           |
| `target_id`  | 대상 ID  | `uuid`        |                                | 작업의 대상이 된 리소스의 ID (예: store_id).         |
| `old_value`  | 변경 전 값 | `jsonb`       |                                | 변경 전 데이터 상태 (필요시).                      |
| `new_value`  | 변경 후 값 | `jsonb`       |                                | 변경 후 데이터 상태 (필요시).                      |
| `created_at` | 발생일시   | `timestamptz` | NOT NULL, DEFAULT `now()`      | 작업이 수행된 시각.                              |