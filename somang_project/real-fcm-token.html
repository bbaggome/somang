<!DOCTYPE html>
<html>
<head>
    <title>ì‹¤ì œ FCM í† í° ìƒì„±ê¸°</title>
    <meta charset="utf-8">
</head>
<body>
    <h1>ğŸ”¥ ì‹¤ì œ Firebase FCM í† í° ìƒì„±</h1>
    
    <div id="status">Firebase ì´ˆê¸°í™” ì¤‘...</div>
    
    <button id="generate-token" onclick="generateRealToken()" style="padding: 10px 20px; font-size: 16px; margin: 20px 0;">
        ì‹¤ì œ FCM í† í° ìƒì„±í•˜ê¸°
    </button>
    
    <div id="token-result" style="margin: 20px 0;"></div>

    <script type="module">
        // Firebase v10 ëª¨ë“ˆ ì‚¬ìš©
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.0.0/firebase-app.js';
        import { getMessaging, getToken, onMessage } from 'https://www.gstatic.com/firebasejs/10.0.0/firebase-messaging.js';

        const firebaseConfig = {
            apiKey: "AIzaSyCdh-JVwPW_ZGOJl_vBH6rDMWl-wJcxFU8",
            authDomain: "t-bridge.firebaseapp.com",
            projectId: "t-bridge",
            storageBucket: "t-bridge.firebasestorage.app",
            messagingSenderId: "896375537648",
            appId: "1:896375537648:web:7d0f83d12dd2c7f9cbbc63"
        };

        const app = initializeApp(firebaseConfig);
        const messaging = getMessaging(app);

        document.getElementById('status').innerHTML = 'âœ… Firebase ì´ˆê¸°í™” ì™„ë£Œ';

        window.generateRealToken = async function() {
            try {
                document.getElementById('token-result').innerHTML = 'í† í° ìƒì„± ì¤‘...';
                
                // Service Worker ë“±ë¡
                if ('serviceWorker' in navigator) {
                    const registration = await navigator.serviceWorker.register('/firebase-messaging-sw.js');
                    console.log('Service Worker ë“±ë¡ ì„±ê³µ:', registration);
                }
                
                // ì•Œë¦¼ ê¶Œí•œ ìš”ì²­
                const permission = await Notification.requestPermission();
                if (permission !== 'granted') {
                    document.getElementById('token-result').innerHTML = 'âŒ ì•Œë¦¼ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.';
                    return;
                }

                // FCM í† í° ê°€ì ¸ì˜¤ê¸° (VAPID í‚¤ ì—†ì´ ì‹œë„)
                console.log('FCM í† í° ê°€ì ¸ì˜¤ê¸° ì‹œì‘...');
                const token = await getToken(messaging);

                if (token) {
                    document.getElementById('token-result').innerHTML = `
                        <div style="border: 2px solid green; padding: 15px; border-radius: 5px;">
                            <h3>âœ… ì‹¤ì œ FCM í† í° ìƒì„± ì„±ê³µ!</h3>
                            <p><strong>Firebase Consoleì—ì„œ ì‚¬ìš©í•˜ì„¸ìš”:</strong></p>
                            <textarea style="width: 100%; height: 100px; font-size: 11px;" readonly>${token}</textarea>
                            <button onclick="copyToken('${token}')" style="margin-top: 10px; padding: 5px 15px;">í† í° ë³µì‚¬</button>
                        </div>
                    `;
                    
                    console.log('ì‹¤ì œ FCM í† í°:', token);
                } else {
                    document.getElementById('token-result').innerHTML = 'âŒ FCM í† í°ì„ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
                }

            } catch (error) {
                console.error('FCM í† í° ìƒì„± ì˜¤ë¥˜:', error);
                document.getElementById('token-result').innerHTML = `âŒ ì˜¤ë¥˜: ${error.message}`;
            }
        };

        window.copyToken = function(token) {
            navigator.clipboard.writeText(token).then(() => {
                alert('í† í°ì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
            });
        };

        // ë©”ì‹œì§€ ë¦¬ìŠ¤ë„ˆ
        onMessage(messaging, (payload) => {
            console.log('ë©”ì‹œì§€ ìˆ˜ì‹ :', payload);
            alert(`ì•Œë¦¼ ìˆ˜ì‹ : ${payload.notification.title}\n${payload.notification.body}`);
        });
    </script>
</body>
</html>