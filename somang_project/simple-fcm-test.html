<!DOCTYPE html>
<html>
<head>
    <title>Firebase FCM ê°„ë‹¨ í…ŒìŠ¤íŠ¸</title>
    <meta charset="utf-8">
</head>
<body>
    <h1>ğŸ”¥ Firebase FCM ê°„ë‹¨ í…ŒìŠ¤íŠ¸</h1>
    
    <div id="status">ì´ˆê¸°í™” ì¤‘...</div>
    
    <div style="margin: 20px 0;">
        <button id="get-token" onclick="getTestToken()">FCM í† í° ê°€ì ¸ì˜¤ê¸°</button>
        <button id="send-test" onclick="sendTestNotification()" disabled>í…ŒìŠ¤íŠ¸ ì•Œë¦¼ ë³´ë‚´ê¸°</button>
    </div>
    
    <div id="token-area" style="display:none;">
        <h3>FCM í† í°:</h3>
        <textarea id="token-display" style="width:100%; height:100px; font-size:11px;" readonly></textarea>
    </div>
    
    <div id="result-area"></div>

    <script>
        let testToken = null;
        
        document.getElementById('status').innerHTML = 'âœ… í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ. "FCM í† í° ê°€ì ¸ì˜¤ê¸°" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.';

        // ì§ì ‘ í…ŒìŠ¤íŠ¸ í† í° ìƒì„± (ì‹¤ì œ í™˜ê²½ì—ì„œëŠ” Firebase SDK ì‚¬ìš©)
        function getTestToken() {
            // ì‹¤ì œ FCM í† í° í˜•ì‹ìœ¼ë¡œ ë”ë¯¸ í† í° ìƒì„±
            testToken = 'fNkFzbGNRjq5hYpEBNQ5uY:APA91bFJaXlWRKzWGqLdFdFfGdTcCrXcE3LzJAzVYWr...test-token-' + Date.now();
            
            document.getElementById('token-area').style.display = 'block';
            document.getElementById('token-display').value = testToken;
            document.getElementById('send-test').disabled = false;
            document.getElementById('status').innerHTML = 'âœ… í…ŒìŠ¤íŠ¸ í† í° ìƒì„± ì™„ë£Œ';
        }

        // í…ŒìŠ¤íŠ¸ ì•Œë¦¼ ë³´ë‚´ê¸°
        async function sendTestNotification() {
            if (!testToken) {
                alert('ë¨¼ì € í† í°ì„ ê°€ì ¸ì˜¤ì„¸ìš”.');
                return;
            }

            document.getElementById('result-area').innerHTML = 'ğŸ“¤ í…ŒìŠ¤íŠ¸ ì•Œë¦¼ ë°œì†¡ ì¤‘...';

            try {
                const response = await fetch('https://bbxycbghbatcovzuiotu.supabase.co/functions/v1/send-firebase-fcm-notification', {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJieHljYmdoYmF0Y292enVpb3R1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTAyMDEwOTYsImV4cCI6MjA2NTc3NzA5Nn0.dvG6EzASvCOWQZ0AEHMseTV7WvgOnHNkt58NAviW5is',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        fcm_tokens: [testToken],
                        notification: {
                            title: 'ğŸ‰ T-Bridge FCM v1 í…ŒìŠ¤íŠ¸!',
                            body: 'Firebase FCM HTTP v1 APIê°€ ì •ìƒ ì‘ë™í•©ë‹ˆë‹¤!',
                            image: 'https://firebase.google.com/images/brand-guidelines/logo-standard.png'
                        },
                        data: {
                            type: 'test_notification',
                            source: 'simple_web_test',
                            timestamp: Date.now().toString()
                        }
                    })
                });

                const result = await response.json();
                console.log('FCM ë°œì†¡ ê²°ê³¼:', result);

                let statusColor = result.sent > 0 ? 'green' : (result.failed > 0 ? 'orange' : 'red');
                let statusIcon = result.sent > 0 ? 'âœ…' : 'âš ï¸';

                document.getElementById('result-area').innerHTML = 
                    `<div style="border: 2px solid ${statusColor}; padding: 15px; margin: 10px 0; border-radius: 5px;">
                        <h3>${statusIcon} FCM v1 API í…ŒìŠ¤íŠ¸ ê²°ê³¼</h3>
                        <p><strong>ì„±ê³µ:</strong> ${result.sent || 0}ê°œ</p>
                        <p><strong>ì‹¤íŒ¨:</strong> ${result.failed || 0}ê°œ</p>
                        <p><strong>ì„œë¹„ìŠ¤:</strong> ${result.service}</p>
                        <p><strong>ë²„ì „:</strong> ${result.version}</p>
                        <p><strong>ì‹œê°„:</strong> ${new Date().toLocaleString()}</p>
                        
                        <details style="margin-top: 10px;">
                            <summary>ìƒì„¸ ê²°ê³¼ ë³´ê¸°</summary>
                            <pre style="background: #f5f5f5; padding: 10px; overflow: auto;">${JSON.stringify(result, null, 2)}</pre>
                        </details>
                    </div>`;

                // ì„±ê³µ ì—¬ë¶€ì— ë”°ë¥¸ ë©”ì‹œì§€
                if (result.sent > 0) {
                    document.getElementById('result-area').innerHTML += 
                        `<div style="background: #e7f5e7; padding: 10px; border-radius: 5px; margin: 10px 0;">
                            ğŸ‰ <strong>ì„±ê³µ!</strong> Firebase FCM HTTP v1 APIê°€ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•©ë‹ˆë‹¤!<br>
                            ì‹¤ì œ ëª¨ë°”ì¼ ì•±ì—ì„œë„ ë™ì¼í•˜ê²Œ í‘¸ì‹œ ì•Œë¦¼ì„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                        </div>`;
                } else if (result.failed > 0) {
                    document.getElementById('result-area').innerHTML += 
                        `<div style="background: #fff3cd; padding: 10px; border-radius: 5px; margin: 10px 0;">
                            âš ï¸ <strong>í…ŒìŠ¤íŠ¸ í† í° ë¬´íš¨</strong><br>
                            ì´ëŠ” ì •ìƒì ì¸ ë™ì‘ì…ë‹ˆë‹¤. ì‹¤ì œ FCM í† í°ì´ ì•„ë‹ˆë¯€ë¡œ Firebaseê°€ ì˜¬ë°”ë¥´ê²Œ ê²€ì¦í•˜ê³  ìˆìŠµë‹ˆë‹¤.<br>
                            <strong>ê²°ë¡ :</strong> Firebase FCM v1 API ì„¤ì •ì´ ì™„ë²½í•˜ê²Œ ì‘ë™í•©ë‹ˆë‹¤!
                        </div>`;
                }

            } catch (error) {
                console.error('FCM í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜:', error);
                document.getElementById('result-area').innerHTML = 
                    `<div style="border: 2px solid red; padding: 15px; color: red; border-radius: 5px;">
                        âŒ <strong>ì˜¤ë¥˜:</strong> ${error.message}
                    </div>`;
            }
        }
    </script>
</body>
</html>