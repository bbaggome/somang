version: '3.8'  # 최신 버전으로 업데이트
services:
  user-app-dev:
    container_name: user-app-dev
    build:
      context: ./user-app
      dockerfile: Dockerfile.dev
    ports:
      - "50331:50331"  # HTTP 포트
      - "50443:50443"  # HTTPS 포트
    volumes:
      - ./user-app:/app
      - /app/node_modules
      - /app/.next
    environment:
      - WATCHPACK_POLLING=true
      - HTTPS=true
      - HTTPS_PORT=50443
    profiles:
      - "dev"
    networks:
      somang-network:
        aliases:
          - user-app-dev

  # 나머지 서비스는 동일
  biz-app-dev:
    container_name: biz-app-dev
    build:
      context: ./biz-app
      dockerfile: Dockerfile.dev
    ports:
      - "50332:50332"  # 동일하게 3000으로 수정
    volumes:
      - ./biz-app:/app
      - /app/node_modules
      - /app/.next
    environment:
      - WATCHPACK_POLLING=true
    profiles:
      - "dev"
    networks:
      somang-network:
        aliases:
          - biz-app-dev

  admin-app-dev:
    container_name: admin-app-dev
    build:
      context: ./admin-app
      dockerfile: Dockerfile.dev
    ports:
      - "50333:50333"  # 동일하게 3000으로 수정
    volumes:
      - ./admin-app:/app
      - /app/node_modules
      - /app/.next
    environment:
      - WATCHPACK_POLLING=true
    profiles:
      - "dev"
    networks:
      somang-network:
        aliases:
          - admin-app-dev

  # 운영 환경 서비스는 기존 설정 유지
  user-app-prod:
    container_name: user-app-prod
    build:
      context: ./user-app
      dockerfile: Dockerfile.prod
    ports:
      - "8000:3000"
    profiles:
      - "prod"
    networks:
      - somang-network

  biz-app-prod:
    container_name: biz-app-prod
    build:
      context: ./biz-app
      dockerfile: Dockerfile.prod
    ports:
      - "8100:3000"
    profiles:
      - "prod"
    networks:
      - somang-network

  admin-app-prod:
    container_name: admin-app-prod
    build:
      context: ./admin-app
      dockerfile: Dockerfile.prod
    ports:
      - "8200:3000"
    profiles:
      - "prod"
    networks:
      - somang-network

networks:
  somang-network:
    driver: bridge
    name: somang-network